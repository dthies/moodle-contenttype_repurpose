define ("contenttype_repurpose/editcontent",["exports","contenttype_repurpose/formupdate","core/fragment","core/modal_events","core/modal_factory","core/notification","core/str","core/templates"],function(a,b,c,d,e,f,g,h){"use strict";Object.defineProperty(a,"__esModule",{value:!0});a.edit=a.init=void 0;b=i(b);c=i(c);d=i(d);e=i(e);f=i(f);h=i(h);function i(a){return a&&a.__esModule?a:{default:a}}var j=function(a,b){var c;e.default.create({large:!1,title:(0,g.get_string)("editmedia","contenttype_repurpose"),type:e.default.types.SAVE_CANCEL,body:""}).then(function(f){var g=f.getRoot();g.on("submit",function(d){var e=new FormData(g.find("form").get(0));d.stopPropagation();d.preventDefault();l(a,b,c,e,f);f.hide()});g.on(d.default.save,function(d){var e=new FormData(g.find("form").get(0));d.stopPropagation();d.preventDefault();l(a,b,c,e,f);f.hide()});document.addEventListener("click",function(d){var e=d.target.closest("[data-action=\"edit\"], button[name=\"addfile\"]");if(e){d.stopPropagation();d.preventDefault();c=d.target.closest("form");k(a,b,c,e,f)}},!0)}).fail(f.default.exception);document.addEventListener("click",m.bind(window,a,b))};a.init=j;var k=function(a,b,d,e,g){for(var j=d.querySelectorAll("[data-action=\"edit\"]"),k=new FormData(d),l={draftid:e.matches("[name=\"addfile\"]")&&k.get("draftid"),key:j.length},m={contextid:a,library:b},n=JSON.parse(k.get("mediafiles")||"[]"),o=0;o<j.length;o++){if(e.contains(j[o])){l.key=o;l.title=n[o].metadata.title||null;l.license=n[o].metadata.license||null}}m.jsonformdata=JSON.stringify(l);c.default.loadFragment("contenttype_repurpose","addfile",a,m).done(function(a,b){g.show();h.default.replaceNodeContents(g.getRoot().find(".modal-body"),a,b)}).fail(f.default.exception)},l=function(a,d,e,g,i){var j=new FormData(e),k=g.get("key"),l=JSON.parse(j.get("mediafiles"));if(!l[k]){var m={},n={contextid:a,library:d};g.forEach(function(a,b){m[b]=a});n.jsonformdata=JSON.stringify(m);c.default.loadFragment("contenttype_repurpose","addfile",a,n).done(function(c,f){try{var j=JSON.parse(c);j.metadata.license=g.get("license");l[k]=j;e.querySelector("input[name=\"mediafiles\"]").setAttribute("value",JSON.stringify(l));b.default.updateForm(a,d,e)}catch(a){i.show();h.default.replaceNodeContents(i.getRoot().find(".modal-body"),c,f)}}).fail(f.default.exception)}else{l[k].metadata.title=g.get("title");l[k].metadata.license=g.get("license");e.querySelector("input[name=\"mediafiles\"]").setAttribute("value",JSON.stringify(l));b.default.updateForm(a,d,e)}},m=function(a,c,d){var e=d.target.closest("[data-action=\"delete\"], [data-action=\"left\"], [data-action=\"right\"]");if(e){var f,g={},h=d.target.closest("form"),j=new FormData(h),k=JSON.parse(j.get("mediafiles"));d.stopPropagation();d.preventDefault();j.forEach(function(a,b){g[b]=a});switch(e.getAttribute("data-action")){case"delete":f=h.querySelectorAll("[data-action=\"delete\"]");for(var l=0;l<f.length;l++){if(e.contains(f.item(l))){k.splice(l,1)}}break;case"left":f=h.querySelectorAll("[data-action=\"left\"]");for(var i=0;i<f.length;i++){if(e.contains(f.item(i))){k.splice(i,2,k[i+1],k[i])}}break;case"right":f=h.querySelectorAll("[data-action=\"right\"]");for(var m=0;m<f.length;m++){if(e.contains(f.item(m))){k.splice(m,2,k[m+1],k[m])}}break;default:break;}h.querySelector("input[name=\"mediafiles\"]").setAttribute("value",JSON.stringify(k));b.default.updateForm(a,c,h)}};a.edit=m});
//# sourceMappingURL=editcontent.min.js.map
