define ("contenttype_repurpose/editbackground",["exports","contenttype_repurpose/formupdate","core/fragment","core/modal_events","core/modal_factory","core/notification","core/str","core/templates"],function(a,b,c,d,e,f,g,h){"use strict";Object.defineProperty(a,"__esModule",{value:!0});a.edit=a.init=void 0;b=i(b);c=i(c);d=i(d);e=i(e);f=i(f);h=i(h);function i(a){return a&&a.__esModule?a:{default:a}}var j=function(a,b){var c;e.default.create({large:!1,title:(0,g.get_string)("addfile","contenttype_repurpose"),type:e.default.types.SAVE_CANCEL,body:""}).then(function(f){var g=f.getRoot();g.on("submit",function(d){var e=new FormData(g.find("form").get(0));d.stopPropagation();d.preventDefault();l(a,b,c,e,f);f.hide()});g.on(d.default.save,function(d){var e=new FormData(g.find("form").get(0));d.stopPropagation();d.preventDefault();l(a,b,c,e,f);f.hide()});document.addEventListener("click",function(d){var e=d.target.closest("[data-action=\"edit\"], button[name=\"backgroundimage[addfile]\"]");if(e){d.stopPropagation();d.preventDefault();c=d.target.closest("form");k(a,b,c,e,f)}},!0);return!0}).fail(f.default.exception);document.addEventListener("click",m.bind(window,a,b))};a.init=j;var k=function(a,b,d,e,g){var i=new FormData(d),j=i.get("background"),k={draftid:i.get("draftid")},l={contextid:a,library:b};if(j){k.license=JSON.parse(j).metadata.license}l.jsonformdata=JSON.stringify(k);c.default.loadFragment("contenttype_repurpose","addfile",a,l).done(function(a,b){g.show();h.default.replaceNodeContents(g.getRoot().find(".modal-body"),a,b)}).fail(f.default.exception)},l=function(a,d,g,h){var i={},j={contextid:a,library:d};h.forEach(function(a,b){i[b]=a});j.jsonformdata=JSON.stringify(i);c.default.loadFragment("contenttype_repurpose","addfile",a,j).done(function(c){var f;try{f=JSON.parse(c)}catch(a){f=JSON.parse(g.querySelector("input[name=\"background\"]").getAttribute("value"))}f.metadata.license=h.get("license");g.querySelector("input[name=\"background\"]").setAttribute("value",JSON.stringify(f));b.default.updateForm(a,d,g)}).fail(f.default.exception)},m=function(a,c,d){var e=d.target.closest("[data-action=\"delete\"]");if(e){var f=e.closest("form");d.stopPropagation();d.preventDefault();f.querySelector("input[name=\"background\"]").setAttribute("value","");b.default.updateForm(a,c,f)}};a.edit=m});
//# sourceMappingURL=editbackground.min.js.map
