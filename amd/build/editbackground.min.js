define("contenttype_repurpose/editbackground",["exports","contenttype_repurpose/formupdate","core/fragment","core/modal_events","core/modal_save_cancel","core/notification","core/str","core/templates"],(function(_exports,_formupdate,_fragment,_modal_events,_modal_save_cancel,_notification,_str,_templates){function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}Object.defineProperty(_exports,"__esModule",{value:!0}),_exports.init=_exports.edit=void 0,_formupdate=_interopRequireDefault(_formupdate),_fragment=_interopRequireDefault(_fragment),_modal_events=_interopRequireDefault(_modal_events),_modal_save_cancel=_interopRequireDefault(_modal_save_cancel),_notification=_interopRequireDefault(_notification),_templates=_interopRequireDefault(_templates);_exports.init=async(contextid,library,cmid)=>{let form;try{const modal=await _modal_save_cancel.default.create({large:!1,title:(0,_str.get_string)("addfile","contenttype_repurpose"),body:""}),root=modal.getRoot();root.on("submit",(function(e){let data=new FormData(root.find("form").get(0));e.stopPropagation(),e.preventDefault(),saveForm(contextid,library,cmid,form,data,modal),modal.hide()})),root.on(_modal_events.default.save,(function(e){let data=new FormData(root.find("form").get(0));e.stopPropagation(),e.preventDefault(),saveForm(contextid,library,cmid,form,data,modal),modal.hide()})),document.addEventListener("click",(e=>{let button=e.target.closest('[data-action="edit"], button[name="backgroundimage[addfile]"]');button&&(e.stopPropagation(),e.preventDefault(),form=e.target.closest("form"),editForm(contextid,library,cmid,form,button,modal))}),!0)}catch(e){_notification.default.exception(e)}document.addEventListener("click",edit.bind(window,contextid,cmid,library))};const editForm=function(contextid,library,cmid,form,button,modal){let formdata=new FormData(form),background=formdata.get("background"),data={draftid:formdata.get("draftid")},params={contextid:contextid,library:library};background&&(data.license=JSON.parse(background).metadata.license),params.jsonformdata=JSON.stringify(data),_fragment.default.loadFragment("contenttype_repurpose","addfile",contextid,params).done((function(html,js){modal.show(),_templates.default.replaceNodeContents(modal.getRoot().find(".modal-body"),html,js)})).fail(_notification.default.exception)},saveForm=function(contextid,library,cmid,form,data){let formdata={},params={contextid:contextid,library:library};data.forEach(((value,key)=>{formdata[key]=value})),params.jsonformdata=JSON.stringify(formdata),_fragment.default.loadFragment("contenttype_repurpose","addfile",contextid,params).done((function(html){let result;try{result=JSON.parse(html)}catch(e){result=JSON.parse(form.querySelector('input[name="background"]').getAttribute("value"))}result.metadata.license=data.get("license"),form.querySelector('input[name="background"]').setAttribute("value",JSON.stringify(result)),_formupdate.default.updateForm(contextid,library,cmid,form)})).fail(_notification.default.exception)},edit=function(contextid,library,cmid,e){let button=e.target.closest('[data-action="delete"]');if(button){let form=button.closest("form");e.stopPropagation(),e.preventDefault(),form.querySelector('input[name="background"]').setAttribute("value",""),_formupdate.default.updateForm(contextid,library,cmid,form)}};_exports.edit=edit}));

//# sourceMappingURL=editbackground.min.js.map