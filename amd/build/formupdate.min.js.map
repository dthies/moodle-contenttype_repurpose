{"version":3,"sources":["../src/formupdate.js"],"names":["init","contextid","library","document","removeEventListener","updateForm","bind","window","addEventListener","e","target","closest","stopPropagation","onbeforeunload","form","nodeName","toLowerCase","parentNode","formdata","FormData","data","forEach","value","key","params","jsonformdata","JSON","stringify","plugin","Fragment","loadFragment","done","html","js","templates","replaceNodeContents","insertBefore","firstChild","remove","fail","notification","exception"],"mappings":"0MAAA,OACA,OACA,O,0DAEoB,QAAPA,CAAAA,IAAO,CAACC,CAAD,CAAYC,CAAZ,CAAwB,CAGxCC,QAAQ,CAACC,mBAAT,CAA6B,QAA7B,CAAuCC,CAAU,CAACC,IAAX,CAAgBC,MAAhB,CAAwBN,CAAxB,CAAmCC,CAAnC,CAAvC,EACAC,QAAQ,CAACK,gBAAT,CAA0B,QAA1B,CAAoCH,CAAU,CAACC,IAAX,CAAgBC,MAAhB,CAAwBN,CAAxB,CAAmCC,CAAnC,CAApC,CACH,C,CAED,GAAMG,CAAAA,CAAU,CAAG,SAASJ,CAAT,CAAoBC,CAApB,CAA6BO,CAA7B,CAAgC,CAC/C,GAAIA,CAAC,CAACC,MAAF,CAASC,OAAT,CAAiB,mEAAjB,CAAJ,CAAyF,CACrFF,CAAC,CAACG,eAAF,GACAL,MAAM,CAACM,cAAP,CAAwB,IAAxB,CACA,GAAIC,CAAAA,CAAI,CAAGL,CAAC,CAACC,MAAb,CACA,MAAuC,MAAhC,GAAAI,CAAI,CAACC,QAAL,CAAcC,WAAd,EAAP,CAA+C,CAC3CF,CAAI,CAAGA,CAAI,CAACG,UACf,CACD,GAAIC,CAAAA,CAAQ,CAAG,GAAIC,CAAAA,QAAJ,CAAaL,CAAb,CAAf,CACIM,CAAI,CAAG,EADX,CAEAF,CAAQ,CAACG,OAAT,CAAiB,SAACC,CAAD,CAAQC,CAAR,CAAgB,CAC7BH,CAAI,CAACG,CAAD,CAAJ,CAAYD,CACf,CAFD,EAGA,GAAIE,CAAAA,CAAM,CAAG,CACTvB,SAAS,CAAEA,CADF,CAETwB,YAAY,CAAEC,IAAI,CAACC,SAAL,CAAeP,CAAf,CAFL,CAGTlB,OAAO,CAAEA,CAHA,CAIT0B,MAAM,CAAE,WAJC,CAAb,CAMAC,UAASC,YAAT,CAAsB,uBAAtB,CAA+C,YAA/C,CAA6D7B,CAA7D,CAAwEuB,CAAxE,EAAgFO,IAAhF,CAAqF,SAASC,CAAT,CAAeC,CAAf,CAAmB,CACpGC,UAAUC,mBAAV,CAA8BrB,CAA9B,CAAoCkB,CAApC,CAA0CC,CAA1C,EACAnB,CAAI,CAACG,UAAL,CAAgBmB,YAAhB,CAA6BtB,CAAI,CAACuB,UAAlC,CAA8CvB,CAA9C,EACAA,CAAI,CAACwB,MAAL,EACH,CAJD,EAIGC,IAJH,CAIQC,UAAaC,SAJrB,CAKH,CACJ,C","sourcesContent":["import Fragment from 'core/fragment';\nimport notification from 'core/notification';\nimport templates from 'core/templates';\n\nexport const init = (contextid, library) => {\n    'use strict';\n\n    document.removeEventListener('change', updateForm.bind(window, contextid, library));\n    document.addEventListener('change', updateForm.bind(window, contextid, library));\n};\n\nconst updateForm = function(contextid, library, e) {\n    if (e.target.closest('#id_category, #id_recurse, #id_question, [data-action=\"update\"]')) {\n        e.stopPropagation();\n        window.onbeforeunload = null;\n        let form = e.target;\n        while (form.nodeName.toLowerCase() !== 'form') {\n            form = form.parentNode;\n        }\n        let formdata = new FormData(form),\n            data = {};\n        formdata.forEach((value, key) => {\n            data[key] = value;\n        });\n        let params = {\n            contextid: contextid,\n            jsonformdata: JSON.stringify(data),\n            library: library,\n            plugin: 'repurpose'\n        };\n        Fragment.loadFragment('contenttype_repurpose', 'formupdate', contextid, params).done(function(html, js) {\n            templates.replaceNodeContents(form, html, js);\n            form.parentNode.insertBefore(form.firstChild, form);\n            form.remove();\n        }).fail(notification.exception);\n    }\n};\n"],"file":"formupdate.min.js"}